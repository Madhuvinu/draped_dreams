<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Draped Dreams - Saree Store</title>
    <script>
      // Universal Dynamic Asset Loading - Works Everywhere
      (function() {
        console.log('ðŸš€ Draped Dreams - Universal Asset Loader Starting...');
        
        const protocol = window.location.protocol;
        const hostname = window.location.hostname;
        const port = window.location.port;
        
        console.log('ðŸ“ Environment Detection:', { protocol, hostname, port });
        
        // Universal environment detection - more comprehensive
        const isDevelopment = hostname === 'localhost' || 
                             hostname === '127.0.0.1' || 
                             hostname.includes('localhost') ||
                             hostname.includes('.local') ||
                             hostname.includes('127.0.0.1') ||
                             hostname === 'dreams.localhost' ||
                             hostname.includes('dreams.localhost') ||
                             // Check if we're accessing via local development setup
                             (hostname.includes('dreams') && hostname.includes('local')) ||
                             // Additional local development patterns
                             hostname.includes('local') ||
                             hostname.includes('dev') ||
                             hostname.includes('test');
        
        console.log('ðŸ” Development check result:', isDevelopment);
        
        // Build base URL dynamically - works everywhere
        let baseUrl;
        if (isDevelopment) {
          baseUrl = `${protocol}//${hostname}:8000`;
          console.log('ðŸ  Using development URL with port 8000');
        } else {
          // Production: Use current hostname with existing port or default
          const productionPort = port ? `:${port}` : '';
          baseUrl = `${protocol}//${hostname}${productionPort}`;
          console.log('ðŸŒ Using production URL');
        }
        
        // Force development mode if we detect local patterns but missed them
        if (!isDevelopment && (hostname.includes('dreams') || hostname.includes('local'))) {
          console.log('ðŸ”„ Forcing development mode based on hostname patterns');
          baseUrl = `${protocol}//${hostname}:8000`;
        }
        
        console.log('ðŸŒ Base URL:', baseUrl);
        console.log('ðŸ”§ Environment:', isDevelopment ? 'Development' : 'Production');
        
        // Additional debugging
        console.log('ðŸ” Full URL analysis:', {
          fullUrl: window.location.href,
          protocol: window.location.protocol,
          hostname: window.location.hostname,
          port: window.location.port,
          pathname: window.location.pathname,
          hash: window.location.hash
        });
        
        // Dynamic asset discovery and loading
        const loadAssets = async () => {
          // Skip asset discovery to avoid 500 errors
          // Frappe doesn't serve directory listings for /files/assets/
          
          // Use environment-specific asset names
          const isProduction = window.location.hostname !== 'localhost' && 
                               window.location.hostname !== '127.0.0.1' && 
                               !window.location.hostname.includes('localhost');
          
          console.log('ðŸ”„ Using fallback assets (asset discovery disabled)');
          console.log('ðŸŒ Environment detected:', isProduction ? 'Production' : 'Development');
          console.log('ðŸ“¦ Loading assets for:', isProduction ? 'Production (65.1.189.119)' : 'Development (dreams.localhost)');
          
             if (isProduction) {
               // Production assets (use existing until new ones are deployed)
               loadAssetFiles('index-ac6ebee6.js', 'index-18b3d283.css');
             } else {
               // Development assets (from local build)
               loadAssetFiles('index-7c8e1384.js', 'index-18b3d283.css');
             }
        };
        
        const loadAssetFiles = (jsFile, cssFile) => {
          const timestamp = new Date().getTime();
          const jsUrl = `${baseUrl}/files/assets/${jsFile}?v=${timestamp}&cb=${Math.random()}`;
          const cssUrl = `${baseUrl}/files/assets/${cssFile}?v=${timestamp}&cb=${Math.random()}`;
          
          console.log('ðŸ“¥ Loading assets:', { jsUrl, cssUrl });
          console.log('ðŸ” Expected auth file: auth-27376b17.js');
          
          // Load CSS
          const link = document.createElement('link');
          link.rel = 'stylesheet';
          link.href = cssUrl;
          link.onload = () => {
            console.log('âœ… CSS loaded successfully');
          };
          link.onerror = () => {
            console.error('âŒ Failed to load CSS:', cssUrl);
          };
          document.head.appendChild(link);
          
          // Load JS
          const script = document.createElement('script');
          script.type = 'module';
          script.crossOrigin = 'anonymous';
          script.src = jsUrl;
          script.onload = () => {
            console.log('âœ… JavaScript loaded successfully');
          };
          script.onerror = () => {
            console.error('âŒ Failed to load JS:', jsUrl);
          };
          document.head.appendChild(script);
        };
        
        // Start loading assets
        loadAssets();
        
        // Global error handler for asset loading
        window.addEventListener('error', (event) => {
          if (event.target.tagName === 'SCRIPT' || event.target.tagName === 'LINK') {
            console.error('ðŸš¨ Asset loading error:', event.target.src || event.target.href);
          }
        });
        
        console.log('ðŸŽ¯ Draped Dreams - Universal Asset Loader Ready!');
      })();
    </script>
  </head>
  <body>
    <div id="app">
      <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: Arial, sans-serif;">
        <div style="text-align: center;">
          <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
          <p style="color: #666; font-size: 16px;">Loading Draped Dreams...</p>
        </div>
      </div>
      <style>
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      </style>
    </div>
  </body>
</html>