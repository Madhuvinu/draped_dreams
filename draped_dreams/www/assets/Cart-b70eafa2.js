import{u as z,r as g,l as I,o as V,b as n,c as i,d as t,e as o,w as d,t as u,F as O,f as A,q as B,m as S,x as F,v as M,_ as l,h as m,k as E,i as R}from"./index-7c8e1384.js";import{_ as c}from"./Button-4b79b8c6.js";import{o as T}from"./orders-1c2479c6.js";import"./base-6b721dc9.js";const J={class:"min-h-screen bg-gray-50"},U={class:"bg-white shadow-sm border-b sticky top-0 z-50"},Q={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},Y={class:"flex justify-between items-center py-4"},W={class:"flex items-center space-x-4"},G={key:0,class:"flex items-center space-x-2"},H={class:"text-sm text-gray-600"},K={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},X={key:0,class:"text-center py-12"},Z={class:"max-w-md mx-auto"},ee={class:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4"},te={class:"flex space-x-4 justify-center"},se={key:1},oe={key:0,class:"text-center py-12"},ae={class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"},re={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},le={class:"lg:col-span-2"},ne={class:"bg-white rounded-lg shadow-sm border"},ie={class:"p-6"},de={class:"text-lg font-semibold text-gray-900 mb-4"},ue={class:"space-y-4"},ce={class:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center"},pe={class:"flex-1"},ge={class:"font-medium text-gray-900"},me={class:"text-sm text-gray-600"},ve={class:"text-sm font-medium text-purple-600"},ye={class:"flex items-center space-x-2"},fe={class:"w-12 text-center font-medium"},xe={class:"text-right"},he={class:"font-medium text-gray-900"},be={class:"lg:col-span-1"},_e={class:"bg-white rounded-lg shadow-sm border sticky top-24"},we={class:"p-6"},ke={class:"space-y-3"},Ce={class:"flex justify-between"},Ie={class:"font-medium"},Se={class:"flex justify-between"},qe={class:"font-medium"},$e={class:"border-t pt-3"},Oe={class:"flex justify-between text-lg font-semibold"},Fe={key:1},De={key:2},Ve={__name:"Cart",setup(Pe){const h=z(),v=g(!1),y=g({}),r=g([]),f=g(!1),x=g(""),_=g("Cash on Delivery"),w=g(""),k=I(()=>r.value.reduce((a,e)=>{const s=parseFloat(e.price)||0,p=parseInt(e.quantity)||0;return a+s*p},0)),q=I(()=>k.value>1e3?0:50),C=I(()=>k.value+q.value),D=()=>{const a=localStorage.getItem("user"),e=localStorage.getItem("isLoggedIn");a&&e==="true"?(v.value=!0,y.value=JSON.parse(a),P()):(v.value=!1,y.value={},console.log("User not logged in, redirecting to register"),h.push("/register"))},P=()=>{const a=localStorage.getItem("cart");if(a){const e=JSON.parse(a);r.value=e.map(s=>({...s,price:parseFloat(s.price)||0,quantity:parseInt(s.quantity)||1,stock_quantity:parseInt(s.stock_quantity)||0}))}},$=(a,e)=>{const s=parseInt(e);if(s<1)return;const p=r.value.find(b=>b.product_id===a);if(p){const b=parseInt(p.stock_quantity)||0;if(s>b){alert(`Only ${b} items available in stock`);return}p.quantity=s,localStorage.setItem("cart",JSON.stringify(r.value))}},j=a=>{r.value=r.value.filter(e=>e.product_id!==a),localStorage.setItem("cart",JSON.stringify(r.value))},L=()=>{localStorage.removeItem("user"),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("cart"),v.value=!1,y.value={},r.value=[],h.push("/products")},N=async()=>{if(!v.value){h.push("/login");return}if(r.value.length===0){alert("Your cart is empty");return}if(!x.value.trim()){alert("Please enter your shipping address");return}f.value=!0;try{const a={customer_email:y.value.email,order_items:r.value.map(s=>({product_id:s.id||s.product_id,product_name:s.product_name||s.name,quantity:s.quantity,price:s.price})),total_amount:C.value,shipping_address:x.value,billing_address:x.value,payment_method:_.value,notes:w.value};console.log("Order data being sent:",a),console.log("Cart items:",r.value);const e=await T.placeOrder(a);e.message&&e.message.success?(localStorage.removeItem("cart"),r.value=[],alert(`Order placed successfully! Order ID: ${e.message.order_id}`),h.push("/products")):alert(`Error: ${e.message?e.message.message:"Failed to place order"}`)}catch(a){console.error("Error placing order:",a),alert("Error placing order. Please try again.")}finally{f.value=!1}};return V(()=>{D()}),(a,e)=>(n(),i("div",J,[t("header",U,[t("div",Q,[t("div",Y,[e[13]||(e[13]=t("div",{class:"flex items-center"},[t("div",{class:"h-8 w-8 bg-purple-600 rounded-lg flex items-center justify-center mr-3"},[t("span",{class:"text-white text-lg"},"ðŸ›ï¸")]),t("h1",{class:"text-2xl font-bold text-gray-900"},"Draped Dreams")],-1)),t("div",W,[o(c,{variant:"ghost",size:"sm",onClick:e[0]||(e[0]=s=>a.$router.push("/products"))},{default:d(()=>[o(l,{name:"shopping-bag",class:"w-5 h-5 mr-2"}),e[9]||(e[9]=m(" Continue Shopping ",-1))]),_:1}),v.value?(n(),i("div",G,[t("span",H,"Welcome, "+u(y.value.first_name||y.value.email)+"!",1),o(c,{variant:"ghost",size:"sm",onClick:L,class:"text-gray-700 hover:bg-gray-100"},{default:d(()=>[o(l,{name:"log-out",class:"w-4 h-4 mr-2"}),e[10]||(e[10]=m(" Logout ",-1))]),_:1})])):(n(),i(O,{key:1},[o(c,{variant:"outline",size:"sm",onClick:e[1]||(e[1]=s=>a.$router.push("/register")),class:"border-purple-600 text-purple-600 hover:bg-purple-50"},{default:d(()=>[o(l,{name:"user-plus",class:"w-4 h-4 mr-2"}),e[11]||(e[11]=m(" Register ",-1))]),_:1}),o(c,{variant:"ghost",size:"sm",onClick:e[2]||(e[2]=s=>a.$router.push("/login")),class:"text-gray-700 hover:bg-gray-100"},{default:d(()=>[o(l,{name:"user",class:"w-4 h-4 mr-2"}),e[12]||(e[12]=m(" Login ",-1))]),_:1})],64))])])])]),t("div",K,[e[29]||(e[29]=t("div",{class:"mb-8"},[t("h2",{class:"text-3xl font-bold text-gray-900"},"Shopping Cart"),t("p",{class:"text-gray-600 mt-2"},"Review your items and proceed to checkout")],-1)),v.value?(n(),i("div",se,[r.value.length===0?(n(),i("div",oe,[t("div",ae,[o(l,{name:"shopping-cart",class:"w-8 h-8 text-gray-400"})]),e[19]||(e[19]=t("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"Your cart is empty",-1)),e[20]||(e[20]=t("p",{class:"text-gray-600 mb-6"},"Add some products to get started!",-1)),o(c,{onClick:e[5]||(e[5]=s=>a.$router.push("/products")),class:"bg-purple-600 hover:bg-purple-700 text-white"},{default:d(()=>[o(l,{name:"shopping-bag",class:"w-4 h-4 mr-2"}),e[18]||(e[18]=m(" Continue Shopping ",-1))]),_:1})])):(n(),i("div",re,[t("div",le,[t("div",ne,[t("div",ie,[t("h3",de,"Cart Items ("+u(r.value.length)+")",1),t("div",ue,[(n(!0),i(O,null,A(r.value,s=>(n(),i("div",{key:s.product_id,class:"flex items-center space-x-4 p-4 border border-gray-200 rounded-lg"},[t("div",ce,[o(l,{name:"image",class:"w-8 h-8 text-gray-400"})]),t("div",pe,[t("h4",ge,u(s.product_name),1),t("p",me,u(s.category),1),t("p",ve,"â‚¹"+u(s.price),1)]),t("div",ye,[o(c,{onClick:p=>$(s.product_id,s.quantity-1),disabled:s.quantity<=1,size:"sm",variant:"outline",class:"w-8 h-8 p-0"},{default:d(()=>[o(l,{name:"minus",class:"w-4 h-4"})]),_:1},8,["onClick","disabled"]),t("span",fe,u(s.quantity),1),o(c,{onClick:p=>$(s.product_id,s.quantity+1),disabled:s.quantity>=s.stock_quantity,size:"sm",variant:"outline",class:"w-8 h-8 p-0"},{default:d(()=>[o(l,{name:"plus",class:"w-4 h-4"})]),_:1},8,["onClick","disabled"])]),t("div",xe,[t("p",he,"â‚¹"+u(((parseFloat(s.price)||0)*(parseInt(s.quantity)||0)).toFixed(2)),1)]),o(c,{onClick:p=>j(s.product_id),size:"sm",variant:"ghost",class:"text-red-600 hover:text-red-700 hover:bg-red-50"},{default:d(()=>[o(l,{name:"trash-2",class:"w-4 h-4"})]),_:1},8,["onClick"])]))),128))])])])]),t("div",be,[t("div",_e,[t("div",we,[e[28]||(e[28]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Order Summary",-1)),t("div",ke,[t("div",Ce,[e[21]||(e[21]=t("span",{class:"text-gray-600"},"Subtotal",-1)),t("span",Ie,"â‚¹"+u(k.value.toFixed(2)),1)]),t("div",Se,[e[22]||(e[22]=t("span",{class:"text-gray-600"},"Shipping",-1)),t("span",qe,"â‚¹"+u(q.value.toFixed(2)),1)]),t("div",$e,[t("div",Oe,[e[23]||(e[23]=t("span",null,"Total",-1)),t("span",null,"â‚¹"+u(C.value.toFixed(2)),1)])])]),t("form",{onSubmit:B(N,["prevent"]),class:"mt-6 space-y-4"},[t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Shipping Address",-1)),S(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>x.value=s),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter your shipping address",required:""},null,512),[[F,x.value]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Payment Method",-1)),S(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>_.value=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",required:""},[...e[25]||(e[25]=[t("option",{value:"Cash on Delivery"},"Cash on Delivery",-1),t("option",{value:"Online Payment"},"Online Payment",-1),t("option",{value:"Bank Transfer"},"Bank Transfer",-1)])],512),[[M,_.value]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Notes (Optional)",-1)),S(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>w.value=s),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Any special instructions?"},null,512),[[F,w.value]])]),o(c,{type:"submit",disabled:f.value,class:"w-full bg-purple-600 hover:bg-purple-700 text-white py-3"},{default:d(()=>[f.value?R("",!0):(n(),E(l,{key:0,name:"check-circle",class:"w-4 h-4 mr-2"})),f.value?(n(),i("span",Fe,"Placing Order...")):(n(),i("span",De,"Place Order (â‚¹"+u(C.value.toFixed(2))+")",1))]),_:1},8,["disabled"])],32)])])])]))])):(n(),i("div",X,[t("div",Z,[t("div",ee,[o(l,{name:"lock",class:"w-8 h-8 text-yellow-600"})]),e[16]||(e[16]=t("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"Authentication Required",-1)),e[17]||(e[17]=t("p",{class:"text-gray-600 mb-6"},"Please login or register to access your cart and place orders.",-1)),t("div",te,[o(c,{onClick:e[3]||(e[3]=s=>a.$router.push("/login")),class:"bg-purple-600 hover:bg-purple-700 text-white"},{default:d(()=>[o(l,{name:"user",class:"w-4 h-4 mr-2"}),e[14]||(e[14]=m(" Login ",-1))]),_:1}),o(c,{onClick:e[4]||(e[4]=s=>a.$router.push("/register")),variant:"outline",class:"border-purple-600 text-purple-600 hover:bg-purple-50"},{default:d(()=>[o(l,{name:"user-plus",class:"w-4 h-4 mr-2"}),e[15]||(e[15]=m(" Register ",-1))]),_:1})])])]))])]))}};export{Ve as default};
